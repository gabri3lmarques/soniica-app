class AccordionMenu{constructor(){this.accordionItems=document.querySelectorAll(".accordion-item"),this.init()}init(){this.accordionItems.forEach(r=>{r.querySelector(".accordion-header").addEventListener("click",()=>{var e=r,t=e.classList.contains("active");this.accordionItems.forEach(e=>{e.classList.remove("active"),e.querySelector(".accordion-content").style.maxHeight=null}),t||(e.classList.add("active"),(t=e.querySelector(".accordion-content")).style.maxHeight=t.scrollHeight+"px")})})}}document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".accordion-item")&&new AccordionMenu});let fm_close=document.querySelector(".fm-close"),modal=document.querySelector(".flash-message-overlay");fm_close&&fm_close.addEventListener("click",function(){modal.style.display="none"});class Player{constructor(){this.audio=new Audio,this.currentSong=null,this.currentPlaylist=null,this.isPlaying=!1,this.isLooping=!1,this.isRandom=!1,this.titleElement=document.querySelector(".current-title"),this.artistElement=document.querySelector(".current-artist"),this.timeElement=document.querySelector(".current-time"),this.gendersElement=document.querySelector(".current-genders"),this.thumbElement=document.querySelector(".current-thumb"),this.playPauseButton=document.querySelector(".play-pause"),this.nextButton=document.querySelector(".next-song"),this.previousButton=document.querySelector(".previous-song"),this.loopButton=document.querySelector(".loop"),this.randomButton=document.querySelector(".random"),this.progressBarContainer=document.querySelector(".progress-bar-container"),this.progressBar=document.querySelector(".progress-bar"),this.volumeSlider=document.querySelector("#volume-slider"),this.playPauseButton&&this.playPauseButton.addEventListener("click",()=>this.togglePlayPause()),this.nextButton&&this.nextButton.addEventListener("click",()=>this.next()),this.previousButton&&this.previousButton.addEventListener("click",()=>this.previous()),this.loopButton&&this.loopButton.addEventListener("click",()=>this.toggleLoop()),this.randomButton&&this.randomButton.addEventListener("click",()=>this.toggleRandom()),this.volumeSlider&&(this.volumeSlider.addEventListener("input",e=>this.adjustVolume(e)),this.audio.volume=this.volumeSlider.value),this.progressBarContainer&&(this.progressBarContainer.addEventListener("click",e=>this.seek(e)),this.progressBarContainer.addEventListener("mousedown",e=>this.startDrag(e))),this.audio.addEventListener("timeupdate",()=>this.updateProgressBar()),this.audio.addEventListener("ended",()=>this.handleSongEnd()),this.initializeFirstSong()}isPlayerDisabled(){return document.querySelector("#player-main")?.classList.contains("disabled")}adjustVolume(e){var e=e.target.value,t=100*e,r=100-t;this.audio.volume=e,this.volumeSlider.style.background=`linear-gradient(to right, #e95265, #207dff ${t}%, #272727 ${r}%)`}initializeFirstSong(){var e=document.querySelector(".playlist");if(e){var t=e.querySelector(".song");if(t){this.currentPlaylist=e;e=(this.currentSong=t).dataset.src;try{var r=atob(e);r.startsWith("http://")||r.startsWith("https://")?(this.audio.src=r,this.updatePlayerInfo(t)):console.error("Invalid decoded URL:",r)}catch(e){console.error("Error decoding URL:",e)}}}}toggleRandom(){this.isPlayerDisabled()||(this.isRandom=!this.isRandom,this.isRandom?this.randomButton.classList.add("active"):this.randomButton.classList.remove("active"))}getRandomSong(){var e;return this.currentPlaylist?(e=Array.from(this.currentPlaylist.querySelectorAll(".song"))).length<=1?e[0]||null:(e=e.filter(e=>e!==this.currentSong))[Math.floor(Math.random()*e.length)]:null}getNextSong(){var e,t;return this.isRandom?this.getRandomSong():(t=(e=[...this.currentPlaylist.querySelectorAll(".song")]).findIndex(e=>e===this.currentSong),e[t+1]||(this.isLooping?e[0]:null))}getPreviousSong(){var e=[...this.currentPlaylist.querySelectorAll(".song")],t=e.findIndex(e=>e===this.currentSong);return e[t-1]||(this.isLooping?e[e.length-1]:null)}play(e,t){if(!this.isPlayerDisabled())try{var r=e.dataset.src,o=atob(r);o.startsWith("http://")||o.startsWith("https://")?(this.currentSong&&this.currentSong!==e&&(this.currentSong.querySelector(".play-button").classList.remove("active"),this.currentSong.classList.remove("active")),this.audio.src!==o&&(this.audio.src=o),this.audio.play(),this.isPlaying=!0,this.currentSong=e,this.currentPlaylist=t,this.updatePlayerInfo(e),this.syncButtons(e)):console.error("Invalid decoded URL:",o)}catch(e){console.error("Error playing song:",e)}}pause(e=null){var t;this.audio.pause(),this.isPlaying=!1,e&&((t=e.querySelector(".play-button"))&&t.classList.remove("active"),e.classList.remove("active")),this.playPauseButton.classList.remove("active")}togglePlayPause(){this.isPlayerDisabled()||(this.isPlaying?this.pause(this.currentSong):(this.audio.play(),this.isPlaying=!0,this.currentSong.querySelector(".play-button").classList.add("active"),this.currentSong.classList.add("active"),this.playPauseButton.classList.add("active")))}toggleLoop(){this.isPlayerDisabled()||(this.isLooping=!this.isLooping,this.isLooping?this.loopButton.classList.add("active"):this.loopButton.classList.remove("active"))}next(){var e;this.isPlayerDisabled()||(e=this.getNextSong())&&this.play(e,this.currentPlaylist)}previous(){var e;this.isPlayerDisabled()||(2<this.audio.currentTime?this.audio.currentTime=0:(e=this.getPreviousSong())&&this.play(e,this.currentPlaylist))}handleSongEnd(){var e=this.getNextSong();e?this.play(e,this.currentPlaylist):(this.isPlaying=!1,this.audio.currentTime=0,this.syncButtons(null))}updatePlayerInfo(e){this.titleElement.textContent=e.querySelector(".title").textContent,this.artistElement.textContent=e.querySelector(".artist").textContent,this.timeElement.textContent=e.querySelector(".time").textContent;e=e.querySelector(".thumb").src;this.thumbElement.src=e}syncButtons(e){document.querySelectorAll(".play-button").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".song").forEach(e=>e.classList.remove("active")),e?(e.querySelector(".play-button").classList.add("active"),e.classList.add("active"),this.playPauseButton.classList.add("active")):this.playPauseButton.classList.remove("active")}updateProgressBar(){var e=this.audio.currentTime/this.audio.duration*100;this.progressBar.style.width=e+"%"}seek(e){var t=this.progressBarContainer.getBoundingClientRect(),e=e.clientX-t.left;this.audio.currentTime=e/t.width*this.audio.duration}startDrag(e){let t=e=>this.seek(e),r=()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",r),this.seek(e)}}document.querySelector("#player-main")&&(window.globalPlayer=new Player,document.addEventListener("click",e=>{var t,e=e.target.closest(".play-button");e&&(t=e.closest(".song"),e=e.closest(".playlist"),t)&&e&&(globalPlayer.currentSong===t&&globalPlayer.isPlaying?globalPlayer.pause(t):globalPlayer.play(t,e))})),document.querySelectorAll(".add-to-playlist-button").forEach(e=>{e.addEventListener("click",r=>{r=r.currentTarget.closest(".song").querySelector(".playlist-form");let o=document.querySelector(".playlist-modal");var i=document.querySelector(".playlist-modal-body");let s=document.querySelector(".playlist-modal-background"),n=document.querySelector(".playlist-modal-close");if(r&&i&&s){r=r.cloneNode(!0);i.innerHTML="",i.appendChild(r),s.classList.add("active");let t=()=>{s.classList.remove("active"),document.removeEventListener("click",e),n&&n.removeEventListener("click",t)},e=e=>{o.contains(e.target)||t()};setTimeout(()=>{document.addEventListener("click",e)},10),n&&n.addEventListener("click",t)}})});let profilePictureForm=document.querySelector("#profile-picture-form"),removeProfilePicture=(profilePictureForm&&profilePictureForm.addEventListener("submit",function(e){e.preventDefault();var e=document.querySelector('input[name="profile_picture"]'),t=new FormData;t.append("action","upload_profile_picture"),t.append("profile_picture",e.files[0]),fetch("/wp-admin/admin-ajax.php",{method:"POST",body:t,credentials:"same-origin"}).then(e=>e.json()).then(e=>{console.log(e.data?.message),document.getElementById("upload-status").textContent=e.data?.message})}),document.getElementById("remove-profile-picture"));function handleDownload(t){return fetch(wpApiSettings.root+"soniica/v1/register-download",{method:"POST",headers:{"X-WP-Nonce":wpApiSettings.nonce,"Content-Type":"application/json"},credentials:"same-origin"}).then(e=>e.json()).then(e=>{if(!e.success)return t.preventDefault(),alert(e.message),!1;e.is_premium||document.querySelectorAll(".download-link").forEach(e=>{e.classList.add("download-blocked"),e.setAttribute("title","You have reached the download limit on free plan today."),e.setAttribute("href","/get-premium"),e.removeAttribute("download")})}).catch(e=>(console.error("Erro:",e),t.preventDefault(),!1)),!0}removeProfilePicture&&removeProfilePicture.addEventListener("click",function(){var e;confirm("Tem certeza que quer remover a imagem de perfil?")&&((e=new FormData).append("action","remove_profile_picture"),fetch("/wp-admin/admin-ajax.php",{method:"POST",body:e,credentials:"same-origin"}).then(e=>e.json()).then(e=>{console.log(e),document.getElementById("upload-status").textContent=e.data?.message||"Erro ao remover imagem.",document.getElementById("profile-picture-preview").src=""}))});let playerDownloadButtons=document.querySelectorAll(".download-link");function isBase64(e){try{return btoa(atob(e))===e}catch(e){return!1}}let PlayerManager=(()=>{let e=null;return{getInstance:function(){return e=e||new Player}}})();function stopGlobalPlayer(){window.globalPlayer&&window.globalPlayer.currentSong&&window.globalPlayer.pause(window.globalPlayer.currentSong)}playerDownloadButtons.forEach(r=>{r.addEventListener("click",e=>{e.preventDefault();e=r.getAttribute("href");let t="";isBase64(e)?(t=atob(e),r.classList.contains("download-blocked")?console.log("deu ruim"):window.open(t,"_blank")):(t=e,window.location.href=t)})}),window.addEventListener("beforeunload",function(e){stopGlobalPlayer()});let userAvatar=document.querySelector(".user-avatar"),userSubMenu=document.querySelector(".user-sub-menu");userAvatar&&userSubMenu&&(userAvatar.addEventListener("click",function(e){userSubMenu.classList.toggle("active")}),document.addEventListener("click",function(e){userAvatar.contains(e.target)||userSubMenu.contains(e.target)||userSubMenu.classList.remove("active")}));
//# sourceMappingURL=main.min.js.map
