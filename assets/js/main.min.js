class AccordionMenu{constructor(){this.accordionItems=document.querySelectorAll(".accordion-item"),this.init()}init(){this.accordionItems.forEach(o=>{o.querySelector(".accordion-header").addEventListener("click",()=>{var e=o,t=e.classList.contains("active");this.accordionItems.forEach(e=>{e.classList.remove("active"),e.querySelector(".accordion-content").style.maxHeight=null}),t||(e.classList.add("active"),(t=e.querySelector(".accordion-content")).style.maxHeight=t.scrollHeight+"px")})})}}document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".accordion-item")&&new AccordionMenu});let fm_close=document.querySelector(".fm-close"),modal=document.querySelector(".flash-message-overlay");fm_close&&fm_close.addEventListener("click",function(){modal.style.display="none"});class Player{constructor(){this.audio=new Audio,this.currentSong=null,this.currentPlaylist=null,this.isPlaying=!1,this.isLooping=!1,this.isRandom=!1,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.initialize()):this.initialize()}initialize(){this.titleElement=document.querySelector(".current-title"),this.artistElement=document.querySelector(".current-artist"),this.timeElement=document.querySelector(".current-time"),this.gendersElement=document.querySelector(".current-genders"),this.thumbElement=document.querySelector(".current-thumb"),this.playPauseButton=document.querySelector(".play-pause"),this.nextButton=document.querySelector(".next-song"),this.previousButton=document.querySelector(".previous-song"),this.loopButton=document.querySelector(".loop"),this.randomButton=document.querySelector(".random"),this.progressBarContainer=document.querySelector(".progress-bar-container"),this.progressBar=document.querySelector(".progress-bar"),this.volumeSlider=document.querySelector("#volume-slider"),this.setupEventListeners(),this.setupAudioEventListeners(),setTimeout(()=>this.initializeFirstSong(),100)}setupEventListeners(){this.playPauseButton&&this.playPauseButton.addEventListener("click",()=>this.togglePlayPause()),this.nextButton&&this.nextButton.addEventListener("click",()=>this.next()),this.previousButton&&this.previousButton.addEventListener("click",()=>this.previous()),this.loopButton&&this.loopButton.addEventListener("click",()=>this.toggleLoop()),this.randomButton&&this.randomButton.addEventListener("click",()=>this.toggleRandom()),this.volumeSlider&&(this.volumeSlider.addEventListener("input",e=>this.adjustVolume(e)),this.audio.volume=this.volumeSlider.value),this.progressBarContainer&&(this.progressBarContainer.addEventListener("click",e=>this.seek(e)),this.progressBarContainer.addEventListener("mousedown",e=>this.startDrag(e)))}setupAudioEventListeners(){this.audio.addEventListener("timeupdate",()=>this.updateProgressBar()),this.audio.addEventListener("ended",()=>this.handleSongEnd()),this.audio.addEventListener("error",e=>{console.error("Audio error:",e),console.error("Audio error code:",this.audio.error?.code),console.error("Audio error message:",this.audio.error?.message),console.error("Audio src:",this.audio.src)}),this.audio.addEventListener("loadstart",()=>{console.log("Loading started for:",this.audio.src)}),this.audio.addEventListener("canplaythrough",()=>{console.log("Can play through:",this.audio.src)})}isPlayerDisabled(){return document.querySelector("#player-main")?.classList.contains("disabled")}adjustVolume(e){var e=e.target.value,t=100*e,o=100-t;this.audio.volume=e,this.volumeSlider.style.background=`linear-gradient(to right, #e95265, #207dff ${t}%, #272727 ${o}%)`}async initializeFirstSong(){try{var e,t=document.querySelector(".playlist");t?(e=t.querySelector(".song"))?(this.currentPlaylist=t,this.currentSong=e,await this.loadAudioSrc(e),this.updatePlayerInfo(e)):console.warn("No songs found in playlist"):console.warn("No playlist found")}catch(e){console.error("Error initializing first song:",e)}}async loadAudioSrc(t){t=t?.dataset?.src;if(!t)throw new Error("No encoded URL found in song element");try{var o=atob(t);if(!o||"string"!=typeof o)throw new Error("Invalid decoded URL");if(!o.startsWith("http://")&&!o.startsWith("https://"))throw new Error("Invalid protocol in URL: "+o);let e=o;"https:"===window.location.protocol&&o.startsWith("http://")&&(e=o.replace("http://","https://"),console.warn("Converting HTTP URL to HTTPS for security:",e)),console.log("Loading audio from:",e),await this.testAudioUrl(e),this.audio.src=e}catch(e){throw console.error("Error decoding/loading URL:",e),console.error("Original encoded URL:",t),e}}async testAudioUrl(i){return new Promise((e,t)=>{let o=new Audio,r=setTimeout(()=>{o.src="",t(new Error("Audio URL test timeout"))},5e3);o.addEventListener("canplay",()=>{clearTimeout(r),o.src="",e()}),o.addEventListener("error",e=>{clearTimeout(r),o.src="",t(new Error("Audio URL test failed: "+e.message))}),o.src=i})}toggleRandom(){this.isPlayerDisabled()||(this.isRandom=!this.isRandom,this.randomButton&&(this.isRandom?this.randomButton.classList.add("active"):this.randomButton.classList.remove("active")))}getRandomSong(){var e;return this.currentPlaylist?(e=Array.from(this.currentPlaylist.querySelectorAll(".song"))).length<=1?e[0]||null:(e=e.filter(e=>e!==this.currentSong))[Math.floor(Math.random()*e.length)]:null}getNextSong(){var e,t;return this.isRandom?this.getRandomSong():this.currentPlaylist?(t=(e=[...this.currentPlaylist.querySelectorAll(".song")]).findIndex(e=>e===this.currentSong),e[t+1]||(this.isLooping?e[0]:null)):null}getPreviousSong(){var e,t;return this.currentPlaylist?(t=(e=[...this.currentPlaylist.querySelectorAll(".song")]).findIndex(e=>e===this.currentSong),e[t-1]||(this.isLooping?e[e.length-1]:null)):null}async play(e,t){if(!this.isPlayerDisabled())try{this.currentSong&&this.currentSong!==e&&this.pause(this.currentSong),await this.loadAudioSrc(e),await this.audio.play(),this.isPlaying=!0,this.currentSong=e,this.currentPlaylist=t,this.updatePlayerInfo(e),this.syncButtons(e)}catch(e){console.error("Error playing song:",e),this.handlePlayError(e)}}handlePlayError(e){console.error("Play error details:",e)}pause(e=null){var t;this.audio.pause(),this.isPlaying=!1,e&&((t=e.querySelector(".play-button"))&&t.classList.remove("active"),e.classList.remove("active")),this.playPauseButton&&this.playPauseButton.classList.remove("active")}async togglePlayPause(){if(!this.isPlayerDisabled())try{var e;this.isPlaying?this.pause(this.currentSong):(await this.audio.play(),this.isPlaying=!0,this.currentSong&&((e=this.currentSong.querySelector(".play-button"))&&e.classList.add("active"),this.currentSong.classList.add("active")),this.playPauseButton&&this.playPauseButton.classList.add("active"))}catch(e){console.error("Error in togglePlayPause:",e),this.handlePlayError(e)}}toggleLoop(){this.isPlayerDisabled()||(this.isLooping=!this.isLooping,this.loopButton&&(this.isLooping?this.loopButton.classList.add("active"):this.loopButton.classList.remove("active")))}next(){var e;this.isPlayerDisabled()||(e=this.getNextSong())&&this.play(e,this.currentPlaylist)}previous(){var e;this.isPlayerDisabled()||(2<this.audio.currentTime?this.audio.currentTime=0:(e=this.getPreviousSong())&&this.play(e,this.currentPlaylist))}handleSongEnd(){var e=this.getNextSong();e?this.play(e,this.currentPlaylist):(this.isPlaying=!1,this.audio.currentTime=0,this.syncButtons(null))}updatePlayerInfo(e){var t,o,r;e&&(t=e.querySelector(".title"),o=e.querySelector(".artist"),r=e.querySelector(".time"),e=e.querySelector(".thumb"),this.titleElement&&t&&(this.titleElement.textContent=t.textContent),this.artistElement&&o&&(this.artistElement.textContent=o.textContent),this.timeElement&&r&&(this.timeElement.textContent=r.textContent),this.thumbElement)&&e&&(this.thumbElement.src=e.src)}syncButtons(e){var t;document.querySelectorAll(".play-button").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".song").forEach(e=>e.classList.remove("active")),e?((t=e.querySelector(".play-button"))&&t.classList.add("active"),e.classList.add("active"),this.playPauseButton&&this.playPauseButton.classList.add("active")):this.playPauseButton&&this.playPauseButton.classList.remove("active")}updateProgressBar(){var e;this.progressBar&&this.audio.duration&&(e=this.audio.currentTime/this.audio.duration*100,this.progressBar.style.width=e+"%")}seek(e){var t;this.progressBarContainer&&this.audio.duration&&(t=this.progressBarContainer.getBoundingClientRect(),e=e.clientX-t.left,this.audio.currentTime=e/t.width*this.audio.duration)}startDrag(e){let t=e=>this.seek(e),o=()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",t),document.addEventListener("mouseup",o),this.seek(e)}}function initializePlayer(){document.querySelector("#player-main")&&(window.globalPlayer=new Player,document.addEventListener("click",e=>{var t,e=e.target.closest(".play-button");e&&(t=e.closest(".song"),e=e.closest(".playlist"),t)&&e&&(window.globalPlayer.currentSong===t&&window.globalPlayer.isPlaying?window.globalPlayer.pause(t):window.globalPlayer.play(t,e))}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializePlayer):initializePlayer(),document.querySelectorAll(".add-to-playlist-button").forEach(e=>{e.addEventListener("click",o=>{o=o.currentTarget.closest(".song").querySelector(".playlist-form");let r=document.querySelector(".playlist-modal");var i=document.querySelector(".playlist-modal-body");let n=document.querySelector(".playlist-modal-background"),s=document.querySelector(".playlist-modal-close");if(o&&i&&n){o=o.cloneNode(!0);i.innerHTML="",i.appendChild(o),n.classList.add("active");let t=()=>{n.classList.remove("active"),document.removeEventListener("click",e),s&&s.removeEventListener("click",t)},e=e=>{r.contains(e.target)||t()};setTimeout(()=>{document.addEventListener("click",e)},10),s&&s.addEventListener("click",t)}})});let profilePictureForm=document.querySelector("#profile-picture-form"),removeProfilePicture=(profilePictureForm&&profilePictureForm.addEventListener("submit",function(e){e.preventDefault();var e=document.querySelector('input[name="profile_picture"]'),t=new FormData;t.append("action","upload_profile_picture"),t.append("profile_picture",e.files[0]),fetch("/wp-admin/admin-ajax.php",{method:"POST",body:t,credentials:"same-origin"}).then(e=>e.json()).then(e=>{console.log(e.data?.message),document.getElementById("upload-status").textContent=e.data?.message})}),document.getElementById("remove-profile-picture"));function handleDownload(t){return fetch(wpApiSettings.root+"soniica/v1/register-download",{method:"POST",headers:{"X-WP-Nonce":wpApiSettings.nonce,"Content-Type":"application/json"},credentials:"same-origin"}).then(e=>e.json()).then(e=>{if(!e.success)return t.preventDefault(),alert(e.message),!1;e.is_premium||document.querySelectorAll(".download-link").forEach(e=>{e.classList.add("download-blocked"),e.setAttribute("title","You have reached the download limit on free plan today."),e.setAttribute("href","/get-premium"),e.removeAttribute("download")})}).catch(e=>(console.error("Erro:",e),t.preventDefault(),!1)),!0}removeProfilePicture&&removeProfilePicture.addEventListener("click",function(){var e;confirm("Tem certeza que quer remover a imagem de perfil?")&&((e=new FormData).append("action","remove_profile_picture"),fetch("/wp-admin/admin-ajax.php",{method:"POST",body:e,credentials:"same-origin"}).then(e=>e.json()).then(e=>{console.log(e),document.getElementById("upload-status").textContent=e.data?.message||"Erro ao remover imagem.",document.getElementById("profile-picture-preview").src=""}))});let playerDownloadButtons=document.querySelectorAll(".download-link");function isBase64(e){try{return btoa(atob(e))===e}catch(e){return!1}}let PlayerManager=(()=>{let e=null;return{getInstance:function(){return e=e||new Player}}})();function stopGlobalPlayer(){window.globalPlayer&&window.globalPlayer.currentSong&&window.globalPlayer.pause(window.globalPlayer.currentSong)}playerDownloadButtons.forEach(o=>{o.addEventListener("click",e=>{e.preventDefault();e=o.getAttribute("href");let t="";isBase64(e)?(t=atob(e),o.classList.contains("download-blocked")?console.log("deu ruim"):window.open(t,"_blank")):(t=e,window.location.href=t)})}),window.addEventListener("beforeunload",function(e){stopGlobalPlayer()});let userAvatar=document.querySelector(".user-avatar"),userSubMenu=document.querySelector(".user-sub-menu");userAvatar&&userSubMenu&&(userAvatar.addEventListener("click",function(e){userSubMenu.classList.toggle("active")}),document.addEventListener("click",function(e){userAvatar.contains(e.target)||userSubMenu.contains(e.target)||userSubMenu.classList.remove("active")}));
//# sourceMappingURL=main.min.js.map
